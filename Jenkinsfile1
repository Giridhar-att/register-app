pipeline {
  agent { label 'jenkins-agent'}
tools {
  jdk 'Java17'
  maven 'Maven2'
}
  stages {
    stage ("cleanup workspace") {
      steps {
        cleanWs()
      }
    }
    stage ( "checkout from SCM") {
      steps {
        git branch: 'main', credentialsId: 'github', url: 'https://github.com/Giridhar-att/register-app/'
      }
    }
   stage ("Build application") {
     steps {
       sh "mvn clean package"
     }
     }
  stage ("Test Application") {
    steps {
      sh "mvn test"
    }
  }
 stage("SonarQube Analysis"){
  steps {
  script {
   withSonarQubeEnv(credentialsID: 'jenkins-sonarqube-token') {
   sh "mvn sonar:sonar"
}
  }
}
}

stage("Qualuty gate"){
steps {
script{
  waitForQualityGate abortPipeline: false, credentialsID: 'jenkins-sonarqube-token'
}
}
}

  }
}
